# 実装状況と不足機能の整理

## ✅ 実装済み機能

### UI/UX
- ✅ 新規送信画面（ドラッグ&ドロップ、OCR、送信先検索・候補表示）
- ✅ 送信履歴画面（一覧表示、フィルタリング、詳細パネル）
- ✅ 受信履歴画面（一覧表示、文脈推測、ネクストアクション）
- ✅ 設定画面（会社情報、テンプレート管理、名刺テンプレート編集）
- ✅ 送信前プレビュー（PDFプレビュー、送信先確認）

### バックエンド機能
- ✅ データベーススキーマ（送信FAX、受信FAX、テンプレート、設定）
- ✅ OCR処理（Tesseract.js）
- ✅ PDF生成（Puppeteer）
- ✅ 送信予約機能のUIとバックエンド構造（cronジョブ設定済み）
- ✅ 自動リトライ機能のUIとロジック構造
- ✅ 3ヶ月経過データの自動削除
- ✅ 文脈推測API（簡易版）
- ✅ ネクストアクション生成API（簡易版）

## ⚠️ 未実装・不完全な機能

### 1. **FAX送受信の実装（最重要）**
- ❌ **FAXプロバイダーとの連携**
  - 現在：モック送信（`isSuccess = true`）
  - 必要：InterFAX、Twilio、eFax等のAPI連携
  - 影響：実際のFAX送信ができない

- ❌ **FAX受信処理（Webhook）**
  - 現在：手動で`/api/received-faxes`にPOSTする必要がある
  - 必要：FAXプロバイダーからのWebhook受信エンドポイント
  - 影響：実際のFAX受信が自動化されない

### 2. **AI-OCR機能（重要）**
- ❌ **OpenAI APIによるAI-OCR**
  - 現在：Tesseract.jsのみ
  - 必要：GPT-4 Vision / GPT-4oによるOCR精度向上
  - 影響：OCR精度が低い可能性

### 3. **名刺テンプレート機能**
- ⚠️ **名刺テンプレートから画像への変換**
  - 現在：HTMLを返すのみ（`html2canvas`の使用を推奨）
  - 必要：クライアント側またはサーバー側で画像変換
  - 影響：名刺をFAXに添付できない

### 4. **通知機能**
- ⚠️ **メール通知の実装**
  - 現在：`console.log`のみ（`lib/notifications.ts`）
  - 必要：SendGrid、AWS SES、Nodemailer等の実装
  - 影響：送信成功/失敗の通知が届かない

### 5. **受信FAXの自動処理**
- ❌ **受信時の自動OCR処理**
  - 現在：手動でOCRを実行する必要がある
  - 必要：受信FAXの自動OCR処理（Webhook受信時に実行）
  - 影響：受信FAXの処理が手動

### 6. **PDF生成の完全実装**
- ⚠️ **名刺を含むFAX用紙の生成**
  - 現在：`obigae`で帯画像とマイソク画像の合成は実装済み
  - 必要：名刺テンプレート画像をFAX用紙に組み込む処理
  - 影響：名刺がFAXに含まれない可能性

### 7. **データ管理機能**
- ❌ **データエクスポート機能**
  - 現在：未実装
  - 必要：CSV/Excel形式でのエクスポート
  - 影響：データの外部利用が困難

- ❌ **バックアップ・復元機能**
  - 現在：未実装
  - 必要：データベースのバックアップ・復元
  - 影響：データ損失リスク

### 8. **認証・権限管理**
- ⚠️ **権限管理の実装**
  - 現在：ログイン機能のみ（簡易実装）
  - 必要：ロールベースアクセス制御（RBAC）
  - 影響：セキュリティリスク

### 9. **エラーハンドリング・ログ**
- ⚠️ **エラーログの記録**
  - 現在：`console.error`のみ
  - 必要：構造化ログ（Winston、Pino等）
  - 影響：問題の追跡が困難

### 10. **パフォーマンス最適化**
- ⚠️ **画像の最適化**
  - 現在：Base64で保存（サイズが大きい）
  - 必要：画像圧縮、CDN配信
  - 影響：パフォーマンス低下の可能性

## 📋 優先度別の実装順序

### 🔴 最優先（MVPとして必須）
1. **FAXプロバイダーとの連携** - 実際のFAX送信ができないと意味がない
2. **FAX受信Webhook** - 実際のFAX受信が自動化されない
3. **名刺テンプレートから画像への変換** - 名刺をFAXに添付できない

### 🟡 高優先度（業務効率に直結）
4. **OpenAI APIによるAI-OCR** - OCR精度向上
5. **受信FAXの自動OCR処理** - 手動作業の削減
6. **メール通知の実装** - 送信結果の通知

### 🟢 中優先度（運用改善）
7. **データエクスポート機能** - データの外部利用
8. **権限管理の実装** - セキュリティ向上
9. **エラーログの記録** - 問題追跡

### 🔵 低優先度（将来の拡張）
10. **バックアップ・復元機能** - データ保護
11. **パフォーマンス最適化** - スケーラビリティ

## 📝 実装時の注意点

1. **FAXプロバイダー選定**
   - InterFAX、Twilio、eFax等の比較検討が必要
   - 日本のFAX番号対応の確認
   - コスト構造の確認

2. **OpenAI API統合**
   - APIキーの環境変数設定
   - レート制限の考慮
   - エラーハンドリング

3. **名刺画像変換**
   - クライアント側：`html2canvas`を使用
   - サーバー側：Puppeteerを使用（既存実装と統一）

4. **Webhook実装**
   - セキュリティ（署名検証）
   - リトライロジック
   - エラーハンドリング






## ✅ 実装済み機能

### UI/UX
- ✅ 新規送信画面（ドラッグ&ドロップ、OCR、送信先検索・候補表示）
- ✅ 送信履歴画面（一覧表示、フィルタリング、詳細パネル）
- ✅ 受信履歴画面（一覧表示、文脈推測、ネクストアクション）
- ✅ 設定画面（会社情報、テンプレート管理、名刺テンプレート編集）
- ✅ 送信前プレビュー（PDFプレビュー、送信先確認）

### バックエンド機能
- ✅ データベーススキーマ（送信FAX、受信FAX、テンプレート、設定）
- ✅ OCR処理（Tesseract.js）
- ✅ PDF生成（Puppeteer）
- ✅ 送信予約機能のUIとバックエンド構造（cronジョブ設定済み）
- ✅ 自動リトライ機能のUIとロジック構造
- ✅ 3ヶ月経過データの自動削除
- ✅ 文脈推測API（簡易版）
- ✅ ネクストアクション生成API（簡易版）

## ⚠️ 未実装・不完全な機能

### 1. **FAX送受信の実装（最重要）**
- ❌ **FAXプロバイダーとの連携**
  - 現在：モック送信（`isSuccess = true`）
  - 必要：InterFAX、Twilio、eFax等のAPI連携
  - 影響：実際のFAX送信ができない

- ❌ **FAX受信処理（Webhook）**
  - 現在：手動で`/api/received-faxes`にPOSTする必要がある
  - 必要：FAXプロバイダーからのWebhook受信エンドポイント
  - 影響：実際のFAX受信が自動化されない

### 2. **AI-OCR機能（重要）**
- ❌ **OpenAI APIによるAI-OCR**
  - 現在：Tesseract.jsのみ
  - 必要：GPT-4 Vision / GPT-4oによるOCR精度向上
  - 影響：OCR精度が低い可能性

### 3. **名刺テンプレート機能**
- ⚠️ **名刺テンプレートから画像への変換**
  - 現在：HTMLを返すのみ（`html2canvas`の使用を推奨）
  - 必要：クライアント側またはサーバー側で画像変換
  - 影響：名刺をFAXに添付できない

### 4. **通知機能**
- ⚠️ **メール通知の実装**
  - 現在：`console.log`のみ（`lib/notifications.ts`）
  - 必要：SendGrid、AWS SES、Nodemailer等の実装
  - 影響：送信成功/失敗の通知が届かない

### 5. **受信FAXの自動処理**
- ❌ **受信時の自動OCR処理**
  - 現在：手動でOCRを実行する必要がある
  - 必要：受信FAXの自動OCR処理（Webhook受信時に実行）
  - 影響：受信FAXの処理が手動

### 6. **PDF生成の完全実装**
- ⚠️ **名刺を含むFAX用紙の生成**
  - 現在：`obigae`で帯画像とマイソク画像の合成は実装済み
  - 必要：名刺テンプレート画像をFAX用紙に組み込む処理
  - 影響：名刺がFAXに含まれない可能性

### 7. **データ管理機能**
- ❌ **データエクスポート機能**
  - 現在：未実装
  - 必要：CSV/Excel形式でのエクスポート
  - 影響：データの外部利用が困難

- ❌ **バックアップ・復元機能**
  - 現在：未実装
  - 必要：データベースのバックアップ・復元
  - 影響：データ損失リスク

### 8. **認証・権限管理**
- ⚠️ **権限管理の実装**
  - 現在：ログイン機能のみ（簡易実装）
  - 必要：ロールベースアクセス制御（RBAC）
  - 影響：セキュリティリスク

### 9. **エラーハンドリング・ログ**
- ⚠️ **エラーログの記録**
  - 現在：`console.error`のみ
  - 必要：構造化ログ（Winston、Pino等）
  - 影響：問題の追跡が困難

### 10. **パフォーマンス最適化**
- ⚠️ **画像の最適化**
  - 現在：Base64で保存（サイズが大きい）
  - 必要：画像圧縮、CDN配信
  - 影響：パフォーマンス低下の可能性

## 📋 優先度別の実装順序

### 🔴 最優先（MVPとして必須）
1. **FAXプロバイダーとの連携** - 実際のFAX送信ができないと意味がない
2. **FAX受信Webhook** - 実際のFAX受信が自動化されない
3. **名刺テンプレートから画像への変換** - 名刺をFAXに添付できない

### 🟡 高優先度（業務効率に直結）
4. **OpenAI APIによるAI-OCR** - OCR精度向上
5. **受信FAXの自動OCR処理** - 手動作業の削減
6. **メール通知の実装** - 送信結果の通知

### 🟢 中優先度（運用改善）
7. **データエクスポート機能** - データの外部利用
8. **権限管理の実装** - セキュリティ向上
9. **エラーログの記録** - 問題追跡

### 🔵 低優先度（将来の拡張）
10. **バックアップ・復元機能** - データ保護
11. **パフォーマンス最適化** - スケーラビリティ

## 📝 実装時の注意点

1. **FAXプロバイダー選定**
   - InterFAX、Twilio、eFax等の比較検討が必要
   - 日本のFAX番号対応の確認
   - コスト構造の確認

2. **OpenAI API統合**
   - APIキーの環境変数設定
   - レート制限の考慮
   - エラーハンドリング

3. **名刺画像変換**
   - クライアント側：`html2canvas`を使用
   - サーバー側：Puppeteerを使用（既存実装と統一）

4. **Webhook実装**
   - セキュリティ（署名検証）
   - リトライロジック
   - エラーハンドリング








